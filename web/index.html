<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ImgBed - 图床管理</title>
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <!-- Login Modal -->
    <div class="modal active" id="loginModal">
        <div class="modal-content login-modal">
            <div class="modal-header">
                <h3>登录</h3>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="tokenInput">访问令牌</label>
                        <input type="password" id="tokenInput" placeholder="请输入访问令牌" required autocomplete="off">
                    </div>
                    <button type="submit" class="btn-primary" style="width: 100%;">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                            <polyline points="10 17 15 12 10 7"/>
                            <line x1="15" y1="12" x2="3" y2="12"/>
                        </svg>
                        登录
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div class="container" id="mainContent" style="display: none;">
        <header>
            <div class="header-left">
                <div class="logo">
                    <svg viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <!-- 外框 -->
                        <rect x="8" y="8" width="32" height="32" rx="4" stroke="currentColor" stroke-width="2.5" fill="none"/>
                        <!-- 山峰图标 -->
                        <path d="M14 32 L20 22 L26 28 L34 18" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" fill="none"/>
                        <!-- 太阳/月亮 -->
                        <circle cx="30" cy="18" r="3" fill="currentColor" opacity="0.8"/>
                        <!-- 底部装饰线 -->
                        <line x1="14" y1="32" x2="34" y2="32" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
                    </svg>
                </div>
                <div class="brand">
                    <h1>ImgBed</h1>
                    <span class="subtitle">轻量图床服务</span>
                </div>
            </div>
            <div class="header-right">
                <div class="stats" id="stats">
                    <div class="stat-item">
                        <div class="stat-value" id="statCount">0</div>
                        <div class="stat-label">图片数量</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="statSize">0 B</div>
                        <div class="stat-label">占用空间</div>
                    </div>
                </div>
                <button class="btn-icon" id="settingsBtn" title="设置">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                </button>
                <button class="btn-icon" id="logoutBtn" title="退出登录">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                </button>
            </div>
        </header>

        <section class="upload-section">
            <div class="upload-box" id="uploadBox">
                <input type="file" id="fileInput" accept="image/*" multiple hidden>
                <div class="upload-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="17 8 12 3 7 8"/>
                        <line x1="12" y1="3" x2="12" y2="15"/>
                    </svg>
                </div>
                <div class="upload-hint">
                    <h3>拖拽图片到此处上传</h3>
                    <p>或点击选择文件</p>
                </div>
                <div class="upload-tips">
                    <span>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        Ctrl+V 粘贴上传
                    </span>
                    <span>
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17 8 12 3 7 8"/>
                            <line x1="12" y1="3" x2="12" y2="15"/>
                        </svg>
                        支持批量上传
                    </span>
                </div>
            </div>
        </section>

        <!-- Upload Progress Panel -->
        <div class="upload-panel" id="uploadPanel" style="display: none;">
            <div class="upload-panel-header">
                <span>上传中</span>
                <button class="btn-close" id="closeUploadPanel">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="upload-panel-body" id="uploadProgress"></div>
        </div>

        <section class="toolbar">
            <div class="search-box">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"/>
                    <path d="m21 21-4.35-4.35"/>
                </svg>
                <input type="text" id="searchInput" placeholder="搜索图片...">
            </div>
            <div class="toolbar-actions">
                <button class="btn-secondary" id="selectModeBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="9 11 12 14 22 4"/>
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    多选
                </button>
                <select id="sortSelect">
                    <option value="newest">最新上传</option>
                    <option value="oldest">最早上传</option>
                    <option value="largest">文件最大</option>
                    <option value="smallest">文件最小</option>
                </select>
                <button class="btn-secondary" id="refreshBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6"/><path d="M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                    </svg>
                    刷新
                </button>
            </div>
        </section>

        <section class="batch-toolbar" id="batchToolbar" style="display: none;">
            <div class="batch-info">
                <span>已选择 <strong id="selectedCount">0</strong> 张图片</span>
            </div>
            <div class="batch-actions">
                <button class="btn-secondary" id="selectAllBtn">全选</button>
                <button class="btn-secondary" id="deselectAllBtn">取消全选</button>
                <button class="btn-danger" id="batchDeleteBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    删除选中
                </button>
                <button class="btn-secondary" id="cancelSelectBtn">退出多选</button>
            </div>
        </section>

        <section class="gallery">
            <div class="gallery-header">
                <h2>图片列表</h2>
                <span class="image-count" id="imageCount"></span>
            </div>
            <div class="image-grid" id="imageGrid"></div>
            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                </div>
                <h3>暂无图片</h3>
                <p>上传第一张图片开始使用</p>
            </div>
            <button class="load-more" id="loadMore">加载更多</button>
        </section>
    </div>

    <!-- 设置弹窗 -->
    <div class="modal" id="settingsModal">
        <div class="modal-content settings-modal">
            <div class="modal-header">
                <h3>设置</h3>
                <button class="close" id="closeSettings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>认证令牌 (Auth Token)</label>
                    <div class="input-group">
                        <input type="password" id="settingsTokenInput" placeholder="输入你的 Token" readonly style="background: var(--bg-secondary); cursor: not-allowed;">
                        <button class="btn-icon" id="toggleToken" title="显示/隐藏">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                                <circle cx="12" cy="12" r="3"/>
                            </svg>
                        </button>
                    </div>
                    <span class="form-hint">用于API调用的认证令牌（只读）</span>
                </div>
                <div class="form-group">
                    <label>默认复制格式</label>
                    <select id="defaultFormat">
                        <option value="url">直接链接</option>
                        <option value="markdown">Markdown</option>
                        <option value="html">HTML</option>
                        <option value="bbcode">BBCode</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>服务端配置</label>
                    <div style="margin-bottom: 12px;">
                        <label style="display: flex; align-items: center; cursor: pointer; margin-bottom: 8px;">
                            <input type="checkbox" id="configCompression" style="margin-right: 8px;">
                            启用图片压缩
                        </label>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="font-size: 12px; margin-bottom: 4px; display: block;">最大宽度 (px)</label>
                        <select id="configMaxWidth" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 13px; background: var(--bg-secondary);">
                            <option value="3840">3840 (4K)</option>
                            <option value="2560">2560 (2K)</option>
                            <option value="1920">1920 (FHD)</option>
                            <option value="1280">1280 (HD)</option>
                            <option value="800">800 (小图)</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="font-size: 12px; margin-bottom: 4px; display: block;">JPEG质量 (%)</label>
                        <input type="number" id="configJpegQuality" min="1" max="100" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 13px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="font-size: 12px; margin-bottom: 4px; display: block;">最大文件大小 (MB)</label>
                        <input type="number" id="configMaxSize" min="1" max="100" style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: var(--radius-sm); font-size: 13px;">
                    </div>
                    <span class="form-hint">修改配置后立即生效，影响新上传的图片</span>
                </div>
                <button class="btn-primary" id="saveSettings" style="width: 100%;">保存设置</button>
            </div>
        </div>
    </div>

    <!-- 图片详情弹窗 -->
    <div class="modal" id="imageModal">
        <div class="modal-content image-modal">
            <button class="close" id="closeModal" style="position: absolute; top: 16px; right: 16px; z-index: 10;">&times;</button>
            <div class="image-preview">
                <img id="modalImage" src="" alt="">
            </div>
            <div class="image-details">
                <div class="image-info">
                    <div class="info-item">
                        <span class="info-label">文件名</span>
                        <span class="info-value" id="infoFilename"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">文件大小</span>
                        <span class="info-value" id="infoSize"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">上传时间</span>
                        <span class="info-value" id="infoDate"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">图片尺寸</span>
                        <span class="info-value" id="infoDimensions"></span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">文件哈希</span>
                        <span class="info-value" id="infoHash" style="font-family: monospace; font-size: 11px; word-break: break-all;"></span>
                    </div>
                </div>
                <div class="link-formats">
                    <div class="format-item">
                        <label>直接链接</label>
                        <div class="input-group">
                            <input type="text" id="urlDirect" readonly>
                            <button class="btn-copy" data-target="urlDirect">复制</button>
                        </div>
                    </div>
                    <div class="format-item">
                        <label>Markdown</label>
                        <div class="input-group">
                            <input type="text" id="urlMarkdown" readonly>
                            <button class="btn-copy" data-target="urlMarkdown">复制</button>
                        </div>
                    </div>
                    <div class="format-item">
                        <label>HTML</label>
                        <div class="input-group">
                            <input type="text" id="urlHtml" readonly>
                            <button class="btn-copy" data-target="urlHtml">复制</button>
                        </div>
                    </div>
                    <div class="format-item">
                        <label>BBCode</label>
                        <div class="input-group">
                            <input type="text" id="urlBbcode" readonly>
                            <button class="btn-copy" data-target="urlBbcode">复制</button>
                        </div>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-secondary" id="viewImage">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                            <circle cx="12" cy="12" r="3"></circle>
                        </svg>
                        查看图片
                    </button>
                    <button class="btn-primary" id="copyDefault">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                        </svg>
                        复制链接
                    </button>
                    <button class="btn-danger" id="deleteImage">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                        删除
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 自定义确认对话框 -->
    <div class="modal" id="confirmModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="confirmTitle">确认操作</h3>
            </div>
            <div class="modal-body">
                <p id="confirmMessage" style="margin: 0; line-height: 1.6;"></p>
            </div>
            <div class="modal-footer" style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button class="btn-secondary" id="confirmCancel">取消</button>
                <button class="btn-danger" id="confirmOk">确定</button>
            </div>
        </div>
    </div>

    <!-- 图片查看器 -->
    <div class="image-viewer" id="imageViewer">
        <div class="viewer-toolbar">
            <button class="viewer-btn" id="viewerZoomOut" title="缩小">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
            <button class="viewer-btn" id="viewerZoomIn" title="放大">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="11" cy="11" r="8"></circle>
                    <path d="M21 21l-4.35-4.35"></path>
                    <line x1="11" y1="8" x2="11" y2="14"></line>
                    <line x1="8" y1="11" x2="14" y2="11"></line>
                </svg>
            </button>
            <button class="viewer-btn" id="viewerRotateLeft" title="逆时针旋转">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
                    <path d="M3 3v5h5"></path>
                </svg>
            </button>
            <button class="viewer-btn" id="viewerRotateRight" title="顺时针旋转">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12a9 9 0 1 1-9-9c2.52 0 4.93 1 6.74 2.74L21 8"></path>
                    <path d="M21 3v5h-5"></path>
                </svg>
            </button>
            <button class="viewer-btn" id="viewerReset" title="重置">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                    <path d="M21 3v5h-5"></path>
                    <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                    <path d="M3 21v-5h5"></path>
                </svg>
            </button>
            <button class="viewer-btn" id="viewerClose" title="关闭">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                </svg>
            </button>
        </div>
        <div class="viewer-container">
            <img id="viewerImage" src="" alt="">
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="/static/app.js"></script>
</body>
</html>
